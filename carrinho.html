<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrinho de Compras - Confeitaria Maria Silva</title>
  <link rel="stylesheet" href="styles.css">
  <script src="carrinho.js" defer></script>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo">
        <span class="logo-icon">üéÇ</span>
        <div class="logo-text">
          <h1>Confeitaria Maria Silva</h1>
          <p>Bolos artesanais feitos com amor</p>
        </div>
      </div>
      <div class="header-right">
        <a href="carrinho.html" class="carrinho-header">
          üõí Carrinho <span id="carrinho-contador" class="carrinho-contador">0</span>
        </a>
      </div>
    </div>
  </header>

  <nav>
    <div class="nav-container">
      <ul>
        <li><a href="index.html">In√≠cio</a></li>
        <li><a href="quem-somos.html">Quem Somos</a></li>
        <li><a href="historia.html">Hist√≥ria</a></li>
        <li><a href="catalogo.html">Cat√°logo</a></li>
        <li><a href="contato.html">Contato</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <h2 class="section-title">üõí Seu Carrinho de Compras</h2>
    
    <div id="carrinho-itens" class="carrinho-container">
      <!-- Itens ser√£o renderizados aqui pelo JavaScript -->
    </div>

    <div id="carrinho-resumo" class="carrinho-resumo" style="display: none;">
      <h3>Resumo do Pedido</h3>
      <div class="resumo-linha">
        <span>Subtotal:</span>
        <span id="carrinho-total">R$ 0,00</span>
      </div>
      <div class="resumo-linha">
        <span>Taxa de entrega:</span>
        <span>A combinar</span>
      </div>
      <div class="resumo-total">
        <span>Total:</span>
        <span id="carrinho-total-final">R$ 0,00</span>
      </div>
      <button onclick="abrirFormularioPedido()" class="btn btn-success" style="width: 100%; margin-top: 20px; padding: 15px; font-size: 1.1em;">
        Finalizar Pedido
      </button>
      <a href="catalogo.html" class="btn btn-secondary" style="width: 100%; margin-top: 10px; text-align: center; display: block;">
        Continuar Comprando
      </a>
    </div>

    <!-- Modal Formul√°rio de Pedido -->
    <div id="modal-pedido" class="modal">
      <div class="modal-content">
        <button class="modal-close" onclick="fecharFormularioPedido()">&times;</button>
        <h2>Finalizar Pedido</h2>
        <p style="color: var(--cor-texto-claro); margin-bottom: 25px;">Preencha seus dados para finalizar a encomenda</p>
        
        <form id="form-pedido" onsubmit="enviarPedidoWhatsApp(event)">
          <div class="form-group">
            <label for="pedido-nome">Nome Completo *</label>
            <input type="text" id="pedido-nome" required placeholder="Seu nome completo">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="pedido-whatsapp">WhatsApp *</label>
              <input type="tel" id="pedido-whatsapp" required placeholder="(14) 99999-9999">
            </div>
            <div class="form-group">
              <label for="pedido-email">Email</label>
              <input type="email" id="pedido-email" placeholder="seu@email.com">
            </div>
          </div>

          <div class="form-group">
            <label for="pedido-endereco">Endere√ßo Completo *</label>
            <input type="text" id="pedido-endereco" required placeholder="Rua, n√∫mero, bairro">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="pedido-cidade">Cidade *</label>
              <input type="text" id="pedido-cidade" required value="Rio Claro">
            </div>
            <div class="form-group">
              <label for="pedido-cep">CEP</label>
              <input type="text" id="pedido-cep" placeholder="00000-000">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="pedido-data">Data de Entrega Desejada *</label>
              <input type="date" id="pedido-data" required min="">
            </div>
            <div class="form-group">
              <label for="pedido-horario">Hor√°rio Preferencial</label>
              <select id="pedido-horario">
                <option value="">Selecione</option>
                <option value="Manh√£ (8h - 12h)">Manh√£ (8h - 12h)</option>
                <option value="Tarde (12h - 18h)">Tarde (12h - 18h)</option>
                <option value="Noite (18h - 20h)">Noite (18h - 20h)</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="pedido-observacoes">Observa√ß√µes Adicionais</label>
            <textarea id="pedido-observacoes" placeholder="Instru√ß√µes especiais, ponto de refer√™ncia, informa√ß√µes sobre o evento, etc."></textarea>
          </div>

          <div class="card" style="background: var(--cor-fundo-cinza); margin: 20px 0;">
            <h3 style="margin-top: 0;">Resumo do Pedido</h3>
            <div id="resumo-pedido-itens"></div>
            <div class="resumo-total">
              <span>Total:</span>
              <span id="resumo-pedido-total">R$ 0,00</span>
            </div>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button type="button" onclick="fecharFormularioPedido()" class="btn btn-secondary">Cancelar</button>
            <button type="submit" class="btn btn-success">Enviar Pedido via WhatsApp</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>Confeitaria Maria Silva</h3>
        <p>Bolos personalizados feitos com carinho h√° mais de 10 anos</p>
      </div>
      <div class="footer-section">
        <h3>Links R√°pidos</h3>
        <a href="index.html">In√≠cio</a>
        <a href="quem-somos.html">Quem Somos</a>
        <a href="catalogo.html">Cat√°logo</a>
        <a href="contato.html">Contato</a>
      </div>
      <div class="footer-section">
        <h3>Contato</h3>
        <p>üìû (11) 99999-9999</p>
        <p>üìß contato@confeitariamariasilva.com</p>
        <p>üìç Rio Claro - SP</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© 2025 Confeitaria Maria Silva - Todos os direitos reservados</p>
    </div>
  </footer>

  <script>
    // Atualizar data m√≠nima para hoje
    document.addEventListener('DOMContentLoaded', function() {
      const hoje = new Date().toISOString().split('T')[0];
      const dataInput = document.getElementById('pedido-data');
      if (dataInput) {
        dataInput.min = hoje;
      }
    });

    // Atualizar resumo quando carrinho mudar
    const observer = new MutationObserver(function() {
      atualizarResumo();
    });

    document.addEventListener('DOMContentLoaded', function() {
      const carrinhoContainer = document.getElementById('carrinho-itens');
      if (carrinhoContainer) {
        observer.observe(carrinhoContainer, { childList: true, subtree: true });
      }
      atualizarResumo();
    });

    function atualizarResumo() {
      const resumo = document.getElementById('carrinho-resumo');
      const totalElement = document.getElementById('carrinho-total');
      const totalFinalElement = document.getElementById('carrinho-total-final');
      
      if (carrinho.itens.length > 0) {
        resumo.style.display = 'block';
        const total = carrinho.calcularTotal();
        if (totalElement) totalElement.textContent = `R$ ${total.toFixed(2)}`;
        if (totalFinalElement) totalFinalElement.textContent = `R$ ${total.toFixed(2)}`;
      } else {
        resumo.style.display = 'none';
      }
    }

    function abrirFormularioPedido() {
      if (carrinho.itens.length === 0) {
        alert('Seu carrinho est√° vazio!');
        return;
      }

      const modal = document.getElementById('modal-pedido');
      const resumoItens = document.getElementById('resumo-pedido-itens');
      const totalPedido = document.getElementById('resumo-pedido-total');

      // Preencher resumo no formul√°rio
      resumoItens.innerHTML = carrinho.itens.map(item => `
        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--cor-borda);">
          <span>${item.nome} ${item.sabor ? `- ${item.sabor}` : ''} x${item.quantidade}kg</span>
          <span style="font-weight: 600;">R$ ${(item.preco * item.quantidade).toFixed(2)}</span>
        </div>
      `).join('');

      totalPedido.textContent = `R$ ${carrinho.calcularTotal().toFixed(2)}`;
      modal.style.display = 'flex';
    }

    function fecharFormularioPedido() {
      document.getElementById('modal-pedido').style.display = 'none';
    }

    function enviarPedidoWhatsApp(event) {
      event.preventDefault();
      
      const dados = {
        nome: document.getElementById('pedido-nome').value,
        whatsapp: document.getElementById('pedido-whatsapp').value,
        email: document.getElementById('pedido-email').value,
        endereco: document.getElementById('pedido-endereco').value,
        cidade: document.getElementById('pedido-cidade').value,
        cep: document.getElementById('pedido-cep').value,
        data: document.getElementById('pedido-data').value,
        horario: document.getElementById('pedido-horario').value,
        observacoes: document.getElementById('pedido-observacoes').value,
        itens: carrinho.itens,
        total: carrinho.calcularTotal()
      };

      // Formatar mensagem para WhatsApp
      let mensagem = 'üç∞ *PEDIDO - CONFEITARIA MARIA SILVA*\n\n';
      mensagem += '*DADOS DO CLIENTE:*\n';
      mensagem += `üë§ Nome: ${dados.nome}\n`;
      mensagem += `üì± WhatsApp: ${dados.whatsapp}\n`;
      if (dados.email) {
        mensagem += `üìß Email: ${dados.email}\n`;
      }
      mensagem += `üìç Endere√ßo: ${dados.endereco}\n`;
      mensagem += `üèôÔ∏è Cidade: ${dados.cidade}\n`;
      if (dados.cep) {
        mensagem += `üìÆ CEP: ${dados.cep}\n`;
      }
      mensagem += `üìÖ Data de Entrega: ${new Date(dados.data).toLocaleDateString('pt-BR')}\n`;
      if (dados.horario) {
        mensagem += `‚è∞ Hor√°rio: ${dados.horario}\n`;
      }
      if (dados.observacoes) {
        mensagem += `üìù Observa√ß√µes: ${dados.observacoes}\n`;
      }
      
      mensagem += '\n*ITENS DO PEDIDO:*\n';
      dados.itens.forEach((item, index) => {
        mensagem += `${index + 1}. *${item.nome}*\n`;
        if (item.sabor) {
          mensagem += `   üéÇ Sabor: ${item.sabor}\n`;
        }
        mensagem += `   üì¶ Quantidade: ${item.quantidade}kg\n`;
        if (item.observacoes) {
          mensagem += `   üí¨ Obs: ${item.observacoes}\n`;
        }
        mensagem += `   üí∞ Pre√ßo: R$ ${(item.preco * item.quantidade).toFixed(2)}\n\n`;
      });
      
      mensagem += `*TOTAL: R$ ${dados.total.toFixed(2)}*\n\n`;
      mensagem += 'Aguardando confirma√ß√£o. Obrigado! üéâ';
      
      // Codificar mensagem para URL
      const mensagemEncoded = encodeURIComponent(mensagem);
      
      // N√∫mero do WhatsApp
      const whatsappNumber = '5514996366473';
      
      // Redirecionar para WhatsApp
      window.open(`https://wa.me/${whatsappNumber}?text=${mensagemEncoded}`, '_blank');
      
      // Limpar carrinho ap√≥s envio
      setTimeout(() => {
        carrinho.limparCarrinho();
        fecharFormularioPedido();
        alert('Pedido enviado com sucesso! Voc√™ ser√° redirecionado para o WhatsApp.');
        window.location.href = 'index.html';
      }, 1000);
    }

    // Fechar modal ao clicar fora
    window.addEventListener('click', function(event) {
      const modal = document.getElementById('modal-pedido');
      if (event.target === modal) {
        fecharFormularioPedido();
      }
    });
  </script>
</body>
</html>
